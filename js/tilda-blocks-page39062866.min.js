function t_throttle(fn,threshhold,scope){var last;var deferTimer;threshhold||(threshhold=250);return function(){var context=scope||this;var now=+new Date();var args=arguments;if(last&&now<last+threshhold){clearTimeout(deferTimer);deferTimer=setTimeout(function(){last=now;fn.apply(context,args)},threshhold)}else{last=now;fn.apply(context,args)}}}
function t979_init(recid,rowheight,guttersizer){var rec=document.getElementById('rec'+recid);if(!rec)return;var grid=rec.querySelector('.t979__grid');if(!grid)return;var items=rec.querySelectorAll('.t979__grid-item');var images=rec.querySelectorAll('.t979__image');var overlayList=rec.querySelectorAll('.t979__overlay');if(guttersizer==='')guttersizer=0;t979_reverse(grid);t979_initMasonry(rec,recid,grid,rowheight,guttersizer,images);if(typeof jQuery!=='undefined'){$(rec).find('.t979').bind('displayChanged',t_throttle(function(){var gutterSizer=parseInt(guttersizer,10);var heightSizer=parseInt(rowheight,10);var containerWidth=grid?grid.offsetWidth:0;var imageWidths=t979_getImageWidths(grid,heightSizer);var rows=t979_divideRows(imageWidths,containerWidth);var heights=[];t979_fitItemsByWidth(rows,heights,containerWidth,heightSizer,gutterSizer);t979_updateItems(grid,rows,heights,gutterSizer);t979_updateGridHeight(grid,heights,gutterSizer)}))}else{var currentBlock=rec.querySelector('.t979');currentBlock.addEventListener('displayChanged',t_throttle(function(){var gutterSizer=parseInt(guttersizer,10);var heightSizer=parseInt(rowheight,10);var containerWidth=grid?grid.offsetWidth:0;var imageWidths=t979_getImageWidths(grid,heightSizer);var rows=t979_divideRows(imageWidths,containerWidth);var heights=[];t979_fitItemsByWidth(rows,heights,containerWidth,heightSizer,gutterSizer);t979_updateItems(grid,rows,heights,gutterSizer);t979_updateGridHeight(grid,heights,gutterSizer)}))}
window.addEventListener('resize',t_throttle(function(){var gutterSizer=parseInt(guttersizer,10);var heightSizer=parseInt(rowheight,10);var containerWidth=grid?grid.offsetWidth:0;var imageWidths=t979_getImageWidths(grid,heightSizer);var rows=t979_divideRows(imageWidths,containerWidth);var heights=[];t979_fitItemsByWidth(rows,heights,containerWidth,heightSizer,gutterSizer);t979_updateItems(grid,rows,heights,gutterSizer);t979_updateGridHeight(grid,heights,gutterSizer)}));t_onFuncLoad('imagesLoaded',function(){imagesLoaded(grid,function(){t979_initMasonry(rec,recid,grid,rowheight,guttersizer,images);Array.prototype.forEach.call(images,function(img){img.style.display='block'})})})}
function t979_reverse(grid){if(grid&&grid.classList.contains('t979__grid_reverse')){for(var i=grid.childElementCount-2;i>=0;i--){grid.appendChild(grid.children[i])}}}
function t979_initMasonry(rec,recid,grid,rowheight,guttersizer,images){var gutterSizer=parseInt(guttersizer,10);var heightSizer=parseInt(rowheight,10);Array.prototype.forEach.call(images,function(img){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&window.lazy==='y'){t979__waitLazyLoadIMG(img,function(){t979_eventOnLoadImg(grid,heightSizer,gutterSizer)})}else{if(img.complete&&img.naturalHeight&&img.naturalWidth){t979_eventOnLoadImg(grid,heightSizer,gutterSizer)}else{img.addEventListener('load',function(){t979_eventOnLoadImg(grid,heightSizer,gutterSizer)})}}})}
function t979__waitLazyLoadIMG(img,cb){if(img.complete&&img.naturalHeight&&img.naturalWidth){cb()}else{setTimeout(function(){t979__waitLazyLoadIMG(img,cb)},500)}}
function t979_eventOnLoadImg(grid,heightSizer,gutterSizer){var containerWidth=grid?grid.offsetWidth:0;var imageWidths=t979_getImageWidths(grid,heightSizer);var rows=t979_divideRows(imageWidths,containerWidth);var heights=[];t979_fitItemsByWidth(rows,heights,containerWidth,heightSizer,gutterSizer);t979_updateItems(grid,rows,heights,gutterSizer);t979_updateGridHeight(grid,heights,gutterSizer)}
function t979_getImageWidths(grid,heightSizer){var imageWidths=[];if(!grid)return!1;var images=grid.querySelectorAll('.t979__image');Array.prototype.forEach.call(images,function(img){imageWidths.push(img.naturalWidth*heightSizer/img.naturalHeight)});return imageWidths}
function t979_divideRows(imageWidths,containerWidth){var rows=[];var curRow=0;var rowWidth=0;Array.prototype.forEach.call(imageWidths,function(item){rowWidth+=item;if(typeof rows[curRow]=='undefined'){rows[curRow]=[]}
rows[curRow].push(item);if(rowWidth>=containerWidth){curRow+=1;rowWidth=0}});return rows}
function t979_fitItemsByWidth(rows,heights,containerWidth,heightSizer,gutterSizer){rows.forEach(function(row){var sumWidth=0;var thresholdRatio=1.5;var rowWidth=containerWidth-gutterSizer*(row.length-1);row.forEach(function(width){sumWidth+=width});var ratio=rowWidth/sumWidth;if(ratio<thresholdRatio){row.forEach(function(width,curRow){width*=ratio;row[curRow]=width});heights.push(heightSizer*ratio)}else{heights.push(heightSizer)}
sumWidth=0;row.forEach(function(width){sumWidth+=width})})}
function t979_updateItems(grid,rows,heights,gutterSizer){if(!grid)return!1;var curRow=0;var curCol=0;var top=0;var left=0;var width=0;var height=0;var items=grid.querySelectorAll('.t979__grid-item');Array.prototype.forEach.call(items,function(item){if(curCol>=rows[curRow].length){top+=heights[curRow];curRow++;curCol=0;if(curRow!==0){top+=gutterSizer}
left=0}
left+=rows[curRow][curCol-1]?rows[curRow][curCol-1]+gutterSizer:0;width=rows[curRow][curCol];height=heights[curRow];item.style.top=top+'px';item.style.left=left+'px';item.style.width=width+'px';item.style.height=height+'px';curCol++})}
function t979_updateGridHeight(grid,heights,gutterSizer){var sumHeight=heights.reduce(function(cur,acc){return cur+acc+gutterSizer},0);sumHeight-=gutterSizer;if(grid)grid.style.height=sumHeight+'px'}